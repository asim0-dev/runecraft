(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[106],{4480:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(4665)}])},4665:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(7876),n=s(4232),r=s(4587),l=s.n(r),c=s(8100);function i(){let{messages:e,loading:t}=function(){let e=(0,c.createClientComponentClient)(),[t,s]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/chat/history"),t=await e.json();t.messages&&s(t.messages)}catch(e){console.error("Failed to fetch chat history:",e)}finally{r(!1)}})();let t=e.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},e=>{let t=e.new;s(e=>[...e,t])}).subscribe();return()=>{e.removeChannel(t)}},[e]),{messages:t,loading:a}}(),[s,r]=(0,n.useState)(""),i=async e=>{if(e.preventDefault(),""!==s.trim())try{await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})}),r("")}catch(e){console.error("Failed to send message:",e)}};return t?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{children:"Loading chat..."})}):(0,a.jsxs)("div",{className:"flex flex-col h-full bg-gray-800 text-white",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[e.profiles.avatar_url&&(0,a.jsx)(l(),{src:e.profiles.avatar_url,alt:e.profiles.username,width:32,height:32,className:"rounded-full"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-bold",children:e.profiles.username}),(0,a.jsx)("p",{children:e.content})]})]},e.id))}),(0,a.jsxs)("form",{onSubmit:i,className:"p-4 flex items-center space-x-2 border-t border-gray-700",children:[(0,a.jsx)("input",{type:"text",value:s,onChange:e=>r(e.target.value),placeholder:"Send a message...",className:"flex-1 p-2 bg-gray-700 rounded-lg text-white placeholder-gray-400"}),(0,a.jsx)("button",{type:"submit",className:"p-2 bg-blue-600 rounded-lg text-white font-bold",children:"Send"})]})]})}var o=s(4696);function d(){return(0,a.jsx)(o.A,{children:(0,a.jsxs)("div",{className:"container mx-auto h-[80vh] p-4 md:p-8 flex flex-col",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-100 mb-4",children:"Global Chat"}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden bg-gray-800 rounded-lg shadow-md",children:(0,a.jsx)(i,{})})]})})}},4696:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(7876),n=s(4232),r=s(9099),l=s(8100);function c(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-t-4 border-yellow-500 border-gray-700 rounded-full animate-spin"})})}function i(e){let{children:t}=e,s=(0,l.createClientComponentClient)(),i=(0,r.useRouter)(),[o,d]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{!async function(){let{data:{session:e}}=await s.auth.getSession();e?d(!1):i.push("/")}()},[i,s]),o)?(0,a.jsx)(c,{}):(0,a.jsx)(a.Fragment,{children:t})}}},e=>{e.O(0,[100,773,636,593,792],()=>e(e.s=4480)),_N_E=e.O()}]);