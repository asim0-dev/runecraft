(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{228:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/market",function(){return s(9548)}])},4696:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(7876),i=s(4232),l=s(9099),r=s(8100);function n(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-t-4 border-yellow-500 border-gray-700 rounded-full animate-spin"})})}function c(e){let{children:t}=e,s=(0,r.createClientComponentClient)(),c=(0,l.useRouter)(),[d,o]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{!async function(){let{data:{session:e}}=await s.auth.getSession();e?o(!1):c.push("/")}()},[c,s]),d)?(0,a.jsx)(n,{}):(0,a.jsx)(a.Fragment,{children:t})}},9099:(e,t,s)=>{e.exports=s(8253)},9548:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(7876),i=s(4232),l=s(8100);function r(){let e=(0,l.createClientComponentClient)(),[t,s]=(0,i.useState)([]),[r,n]=(0,i.useState)(!0),[c,d]=(0,i.useState)(null);return((0,i.useEffect)(()=>{!async function(){let{data:t,error:a}=await e.from("market_listings").select("\n          id,\n          seller_id,\n          quantity,\n          price,\n          items (\n            name,\n            emoji,\n            rarity\n          ),\n          profiles!market_listings_seller_id_fkey (\n            username\n          )\n        ").eq("status","active").order("created_at",{ascending:!1});a?(console.error("Error fetching market listings:",a),d("Failed to load market listings.")):s(t||[]),n(!1)}()},[e]),r)?(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"bg-gray-800 h-10 w-full rounded-md mb-2"}),(0,a.jsx)("div",{className:"bg-gray-800 h-10 w-full rounded-md mb-2"}),(0,a.jsx)("div",{className:"bg-gray-800 h-10 w-full rounded-md mb-2"})]}):c?(0,a.jsx)("p",{className:"text-center text-red-400",children:c}):0===t.length?(0,a.jsx)("p",{className:"text-center text-gray-400",children:"No active listings found. Be the first to sell!"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Item"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Quantity"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Price"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Seller"}),(0,a.jsx)("th",{scope:"col",className:"relative px-6 py-3",children:(0,a.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,a.jsx)("tbody",{className:"bg-gray-900 divide-y divide-gray-700",children:t.map(e=>{var t,s,i,l;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10 text-3xl",children:e.items&&(null==(t=e.items[0])?void 0:t.emoji)}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-100",children:e.items&&(null==(s=e.items[0])?void 0:s.name)}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:e.items&&(null==(i=e.items[0])?void 0:i.rarity)})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm text-gray-100",children:["x",e.quantity]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-100",children:["\uD83D\uDCB0 ",e.price.toLocaleString()]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-100",children:e.profiles&&(null==(l=e.profiles[0])?void 0:l.username)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{className:"text-indigo-400 hover:text-indigo-200",children:"Buy"})})]},e.id)})})]})})}function n(){let e=(0,l.createClientComponentClient)(),[t,s]=(0,i.useState)([]),[r,n]=(0,i.useState)(!0),[c,d]=(0,i.useState)(null),[o,m]=(0,i.useState)(1),[x,u]=(0,i.useState)(0);(0,i.useEffect)(()=>{!async function(){let{data:{user:t}}=await e.auth.getUser();if(t){let{data:a,error:i}=await e.from("inventories").select("item_id, qty, items(name)").eq("user_id",t.id).gt("qty",0);i?console.error("Error fetching inventory for listing:",i):s(a||[])}n(!1)}()},[e]);let h=async t=>{if(t.preventDefault(),!c||o<=0||x<=0)return void alert("Please fill out all fields correctly.");try{let{data:{session:t}}=await e.auth.getSession(),s=null==t?void 0:t.access_token,a=await fetch("/api/market/list",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({item_id:c,quantity:o,price:x})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to list item.")}alert("Item listed successfully!"),d(null),m(1),u(0)}catch(e){alert("Error: ".concat(e.message))}};return r?(0,a.jsx)("p",{className:"text-center text-gray-400",children:"Loading inventory..."}):0===t.length?(0,a.jsx)("p",{className:"text-center text-gray-400",children:"You have no items to list!"}):(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"List an Item for Sale"}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"item",className:"block text-sm font-medium text-gray-300",children:"Item"}),(0,a.jsxs)("select",{id:"item",value:c||"",onChange:e=>d(parseInt(e.target.value)),className:"mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white",children:[(0,a.jsx)("option",{value:"",children:"-- Select an item --"}),t.map(e=>{var t;return(0,a.jsxs)("option",{value:e.item_id,children:[null==(t=e.items)?void 0:t.name," (x",e.qty,")"]},e.item_id)})]})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-300",children:"Quantity"}),(0,a.jsx)("input",{type:"number",id:"quantity",value:o,onChange:e=>m(Math.max(1,parseInt(e.target.value)||1)),min:"1",className:"mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-300",children:"Price (Coins)"}),(0,a.jsx)("input",{type:"number",id:"price",value:x,onChange:e=>u(Math.max(0,parseInt(e.target.value)||0)),min:"0",className:"mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white"})]})]}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-bold hover:bg-indigo-700 transition-colors",children:"List Item"})]})]})}var c=s(4696);function d(){return(0,a.jsx)(c.A,{children:(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-100 mb-8",children:"The Global Market"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-200 mb-4",children:"Active Listings"}),(0,a.jsx)(r,{})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-200 mb-4",children:"Sell an Item"}),(0,a.jsx)(n,{})]})]})]})})}}},e=>{e.O(0,[100,636,593,792],()=>e(e.s=228)),_N_E=e.O()}]);